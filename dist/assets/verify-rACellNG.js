import{r as M,l as A,g as N,A as k,u as F,j as m,d as T,B as j}from"./index-BPKYvsHV.js";var _={exports:{}};(function(U,O){(function(y,v){U.exports=v(M)})(A,function(w){return function(y){var v={};function d(i){if(v[i])return v[i].exports;var o=v[i]={i,l:!1,exports:{}};return y[i].call(o.exports,o,o.exports,d),o.l=!0,o.exports}return d.m=y,d.c=v,d.d=function(i,o,p){d.o(i,o)||Object.defineProperty(i,o,{enumerable:!0,get:p})},d.r=function(i){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(i,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(i,"__esModule",{value:!0})},d.t=function(i,o){if(o&1&&(i=d(i)),o&8||o&4&&typeof i=="object"&&i&&i.__esModule)return i;var p=Object.create(null);if(d.r(p),Object.defineProperty(p,"default",{enumerable:!0,value:i}),o&2&&typeof i!="string")for(var S in i)d.d(p,S,(function(b){return i[b]}).bind(null,S));return p},d.n=function(i){var o=i&&i.__esModule?function(){return i.default}:function(){return i};return d.d(o,"a",o),o},d.o=function(i,o){return Object.prototype.hasOwnProperty.call(i,o)},d.p="",d(d.s="./src/react-webcam.tsx")}({"./src/react-webcam.tsx":function(y,v,d){d.r(v);var i=d("react"),o=function(){var c=function(a,e){return c=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var r in n)n.hasOwnProperty(r)&&(t[r]=n[r])},c(a,e)};return function(a,e){c(a,e);function t(){this.constructor=a}a.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}}(),p=function(){return p=Object.assign||function(c){for(var a,e=1,t=arguments.length;e<t;e++){a=arguments[e];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(c[n]=a[n])}return c},p.apply(this,arguments)},S=function(c,a){var e={};for(var t in c)Object.prototype.hasOwnProperty.call(c,t)&&a.indexOf(t)<0&&(e[t]=c[t]);if(c!=null&&typeof Object.getOwnPropertySymbols=="function")for(var n=0,t=Object.getOwnPropertySymbols(c);n<t.length;n++)a.indexOf(t[n])<0&&Object.prototype.propertyIsEnumerable.call(c,t[n])&&(e[t[n]]=c[t[n]]);return e};(function(){typeof window>"u"||(navigator.mediaDevices===void 0&&(navigator.mediaDevices={}),navigator.mediaDevices.getUserMedia===void 0&&(navigator.mediaDevices.getUserMedia=function(a){var e=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia;return e?new Promise(function(t,n){e.call(navigator,a,t,n)}):Promise.reject(new Error("getUserMedia is not implemented in this browser"))}))})();function b(){return!!(navigator.mediaDevices&&navigator.mediaDevices.getUserMedia)}var C=function(c){o(a,c);function a(e){var t=c.call(this,e)||this;return t.canvas=null,t.ctx=null,t.requestUserMediaId=0,t.unmounted=!1,t.state={hasUserMedia:!1},t}return a.prototype.componentDidMount=function(){var e=this,t=e.state,n=e.props;if(this.unmounted=!1,!b()){n.onUserMediaError("getUserMedia not supported");return}t.hasUserMedia||this.requestUserMedia(),n.children&&typeof n.children!="function"&&console.warn("children must be a function")},a.prototype.componentDidUpdate=function(e){var t=this.props;if(!b()){t.onUserMediaError("getUserMedia not supported");return}var n=JSON.stringify(e.audioConstraints)!==JSON.stringify(t.audioConstraints),r=JSON.stringify(e.videoConstraints)!==JSON.stringify(t.videoConstraints),h=e.minScreenshotWidth!==t.minScreenshotWidth,u=e.minScreenshotHeight!==t.minScreenshotHeight;(r||h||u)&&(this.canvas=null,this.ctx=null),(n||r)&&(this.stopAndCleanup(),this.requestUserMedia())},a.prototype.componentWillUnmount=function(){this.unmounted=!0,this.stopAndCleanup()},a.stopMediaStream=function(e){e&&(e.getVideoTracks&&e.getAudioTracks?(e.getVideoTracks().map(function(t){e.removeTrack(t),t.stop()}),e.getAudioTracks().map(function(t){e.removeTrack(t),t.stop()})):e.stop())},a.prototype.stopAndCleanup=function(){var e=this.state;e.hasUserMedia&&(a.stopMediaStream(this.stream),e.src&&window.URL.revokeObjectURL(e.src))},a.prototype.getScreenshot=function(e){var t=this,n=t.state,r=t.props;if(!n.hasUserMedia)return null;var h=this.getCanvas(e);return h&&h.toDataURL(r.screenshotFormat,r.screenshotQuality)},a.prototype.getCanvas=function(e){var t=this,n=t.state,r=t.props;if(!this.video||!n.hasUserMedia||!this.video.videoHeight)return null;if(!this.ctx){var h=this.video.videoWidth,u=this.video.videoHeight;if(!this.props.forceScreenshotSourceSize){var s=h/u;h=r.minScreenshotWidth||this.video.clientWidth,u=h/s,r.minScreenshotHeight&&u<r.minScreenshotHeight&&(u=r.minScreenshotHeight,h=u*s)}this.canvas=document.createElement("canvas"),this.canvas.width=(e==null?void 0:e.width)||h,this.canvas.height=(e==null?void 0:e.height)||u,this.ctx=this.canvas.getContext("2d")}var g=this,l=g.ctx,f=g.canvas;return l&&f&&(f.width=(e==null?void 0:e.width)||f.width,f.height=(e==null?void 0:e.height)||f.height,r.mirrored&&(l.translate(f.width,0),l.scale(-1,1)),l.imageSmoothingEnabled=r.imageSmoothing,l.drawImage(this.video,0,0,(e==null?void 0:e.width)||f.width,(e==null?void 0:e.height)||f.height),r.mirrored&&(l.scale(-1,1),l.translate(-f.width,0))),f},a.prototype.requestUserMedia=function(){var e=this,t=this.props,n=function(u,s){var g={video:typeof s<"u"?s:!0};t.audio&&(g.audio=typeof u<"u"?u:!0),e.requestUserMediaId++;var l=e.requestUserMediaId;navigator.mediaDevices.getUserMedia(g).then(function(f){e.unmounted||l!==e.requestUserMediaId?a.stopMediaStream(f):e.handleUserMedia(null,f)}).catch(function(f){e.handleUserMedia(f)})};if("mediaDevices"in navigator)n(t.audioConstraints,t.videoConstraints);else{var r=function(u){return{optional:[{sourceId:u}]}},h=function(u){var s=u.deviceId;return typeof s=="string"?s:Array.isArray(s)&&s.length>0?s[0]:typeof s=="object"&&s.ideal?s.ideal:null};MediaStreamTrack.getSources(function(u){var s=null,g=null;u.forEach(function(x){x.kind==="audio"?s=x.id:x.kind==="video"&&(g=x.id)});var l=h(t.audioConstraints);l&&(s=l);var f=h(t.videoConstraints);f&&(g=f),n(r(s),r(g))})}},a.prototype.handleUserMedia=function(e,t){var n=this.props;if(e||!t){this.setState({hasUserMedia:!1}),n.onUserMediaError(e);return}this.stream=t;try{this.video&&(this.video.srcObject=t),this.setState({hasUserMedia:!0})}catch{this.setState({hasUserMedia:!0,src:window.URL.createObjectURL(t)})}n.onUserMedia(t)},a.prototype.render=function(){var e=this,t=this,n=t.state,r=t.props,h=r.audio;r.forceScreenshotSourceSize;var u=r.disablePictureInPicture;r.onUserMedia,r.onUserMediaError,r.screenshotFormat,r.screenshotQuality,r.minScreenshotWidth,r.minScreenshotHeight,r.audioConstraints,r.videoConstraints,r.imageSmoothing;var s=r.mirrored,g=r.style,l=g===void 0?{}:g,f=r.children,x=S(r,["audio","forceScreenshotSourceSize","disablePictureInPicture","onUserMedia","onUserMediaError","screenshotFormat","screenshotQuality","minScreenshotWidth","minScreenshotHeight","audioConstraints","videoConstraints","imageSmoothing","mirrored","style","children"]),P=s?p(p({},l),{transform:(l.transform||"")+" scaleX(-1)"}):l,E={getScreenshot:this.getScreenshot.bind(this)};return i.createElement(i.Fragment,null,i.createElement("video",p({autoPlay:!0,disablePictureInPicture:u,src:n.src,muted:!h,playsInline:!0,ref:function(I){e.video=I},style:P},x)),f&&f(E))},a.defaultProps={audio:!1,disablePictureInPicture:!1,forceScreenshotSourceSize:!1,imageSmoothing:!0,mirrored:!1,onUserMedia:function(){},onUserMediaError:function(){},screenshotFormat:"image/webp",screenshotQuality:.92},a}(i.Component);v.default=C},react:function(y,v){y.exports=w}}).default})})(_);var V=_.exports;const W=N(V),R=()=>{const{address:U}=useWeb3ModalAccount(),{auth:O}=M.useContext(k),[w,y]=M.useState(!1),[v,d]=M.useState(!1),[i,o]=M.useState(""),[p,S]=M.useState(!1),b=M.useRef(null),C=F(),c=async()=>{try{if(b.current){const e=b.current.getScreenshot();if(e){const t=atob(e.split(",")[1]),n=e.split(",")[0].split(":")[1].split(";")[0],r=new ArrayBuffer(t.length),h=new Uint8Array(r);for(let l=0;l<t.length;l++)h[l]=t.charCodeAt(l);const u=new Blob([r],{type:n}),s=new FormData;s.append("image",u,"screenshot.png"),s.append("walletAddress",U),console.log(U);const g=await T.post("/verify",s,{headers:{Authorization:`Bearer ${O.accessToken}`,"Content-Type":"multipart/form-data"}});g.data.status==="success"?(d(!0),o("Verification Successful!"),j.success("Face verification Successful!"),setTimeout(()=>{y(!1)},1e3),C("/")):g.data.status==="notFound"?(o("Id card image not found. make sure you upload it and try again."),j.error("Id card image not found. make sure you upload it and try again."),y(!1),S(!0)):(o("Verification Failed. Please try again."),j.error("Verification Failed. Please try again."),y(!1),S(!0))}}}catch(e){console.error("Verification failed:",e),o("No face detected in the image. Please try again."),j.error("No face detected in the image. Please try again."),y(!1),S(!0)}},a=()=>{y(!0),d(!1),o(""),S(!1)};return m.jsx("div",{className:"flex flex-col items-center justify-center",children:w?m.jsxs(m.Fragment,{children:[m.jsxs("div",{className:"relative w-full max-w-md",children:[m.jsx(W,{audio:!1,ref:b,screenshotFormat:"image/jpeg",className:"w-full rounded-lg",videoConstraints:{width:500,height:600,facingMode:"user"}}),m.jsx("div",{className:`absolute inset-0 flex items-center justify-center rounded-full border-4 ${v?"border-green-500":"border-red-500"}`,style:{width:"70%",height:"70%",borderRadius:"50%",top:"15%",left:"15%"}})]}),v?m.jsx("button",{onClick:c,className:"mt-4 bg-green-500 text-white py-2 px-6 rounded hover:bg-green-600",children:"Verified"}):m.jsx("button",{onClick:c,className:"mt-4 bg-blue-500 text-white py-2 px-6 rounded hover:bg-blue-600",children:"Capture Image"})]}):m.jsxs(m.Fragment,{children:[v?"":m.jsx("button",{onClick:a,className:"bg-yellow-500 text-white py-2 px-6 rounded hover:bg-yellow-600",children:i?"Capture Again":"Start Verification"}),i&&m.jsx("p",{className:`mt-4 text-xl font-semibold ${p?"text-red-600":"text-green-600"}`,children:i})]})})};function z(){return m.jsx("div",{className:"flex flex-col items-center",children:m.jsx(R,{})})}export{z as default};
